# Интеграция календаря в BidResource

## Что реализовано

✅ **Календарь интегрирован в BidResource**
- Календарь отображается на страницах создания и редактирования заявок
- Использует кастомный виджет `BidCalendarWidget` на основе `AppointmentCalendarWidget`
- Поддерживает выбор времени через календарь для заполнения поля `appointment_datetime`

## Функционал календаря

### Отображение слотов
- Смены врачей отображаются в календаре с временными слотами
- Занятые слоты показываются красным цветом
- Свободные слоты показываются зеленым цветом
- Поддерживаются виды: месяц, неделя, день, список
- **Фильтрация происходит автоматически на основе выбранных полей формы**

### Реактивная фильтрация
- Календарь автоматически фильтруется при выборе города, клиники, филиала или врача
- Слоты показываются только для выбранных параметров
- При изменении любого поля формы календарь обновляется в реальном времени
- Нет необходимости в дополнительных фильтрах - все управляется через поля формы

### Выбор времени
1. Выберите город, клинику, филиал и врача в форме
2. Календарь автоматически покажет доступные слоты для выбранных параметров
3. Кликните на свободный слот в календаре
4. Время автоматически заполнится в поле "Дата и время приема"
5. Связанные поля обновятся автоматически
6. Появится уведомление об успешном выборе времени

### Просмотр занятых слотов
1. Кликните на занятый слот в календаре
2. Появится уведомление с информацией о записи
3. Показывается ФИО пациента и телефон

## Технические детали

### Файлы
- `app/Filament/Widgets/BidCalendarWidget.php` - кастомный виджет календаря
- `app/Filament/Resources/BidResource/Pages/CreateBid.php` - страница создания с календарем
- `app/Filament/Resources/BidResource/Pages/EditBid.php` - страница редактирования с календарем
- `resources/views/filament/pages/bid-calendar-integration.blade.php` - JavaScript интеграция
- `resources/js/bid-calendar-integration.js` - JavaScript функции

### Интеграция
- Календарь отображается в заголовке страниц через `getHeaderWidgets()`
- JavaScript обрабатывает события выбора времени через Livewire
- Поля формы обновляются автоматически при выборе времени
- Поддерживается реактивность полей формы с `live()` модификатором
- Данные формы передаются в календарь через `formData` параметр

### События
- `slotSelected` - событие выбора свободного слота
- `slotOccupied` - событие клика по занятому слоту
- `formDataUpdated` - событие обновления данных формы для фильтрации календаря

## Использование

1. Откройте страницу создания или редактирования заявки
2. Календарь отобразится под формой
3. Используйте фильтры для настройки отображения
4. Кликайте по свободным слотам для выбора времени
5. Поля формы заполнятся автоматически

## Права доступа

- **super_admin**: полный доступ ко всем слотам
- **partner**: доступ только к слотам своей клиники
- **doctor**: только просмотр своих слотов

## Настройки календаря

- Рабочие часы: 8:00 - 20:00
- Длительность слота: 15 минут
- Привязка к интервалам: 5 минут
- Локализация: русский язык
- Вид по умолчанию: неделя
