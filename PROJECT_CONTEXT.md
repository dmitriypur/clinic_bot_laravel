# –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê: –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä - Laravel + Telegram Bot

## üìã –û–ë–©–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø

**–ó–∞–¥–∞—á–∞:** –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Flask Python –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Laravel —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 20 –∞–≤–≥—É—Å—Ç–∞ 2025
**Laravel –≤–µ—Ä—Å–∏—è:** 12.25.0
**PHP –≤–µ—Ä—Å–∏—è:** 8.3.16

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (–∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ Flask):
- **User** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (–∞–¥–º–∏–Ω—ã, –≤—Ä–∞—á–∏)
- **Application** - –∑–∞—è–≤–∫–∏ –Ω–∞ –∑–∞–ø–∏—Å—å –∫ –≤—Ä–∞—á—É
- **City** - –≥–æ—Ä–æ–¥–∞ –≥–¥–µ –µ—Å—Ç—å –∫–ª–∏–Ω–∏–∫–∏
- **Clinic** - –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∫–ª–∏–Ω–∏–∫–∏
- **Doctor** - –≤—Ä–∞—á–∏ —Å —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏
- **Review** - –æ—Ç–∑—ã–≤—ã –æ –≤—Ä–∞—á–∞—Ö (1-5 –∑–≤–µ–∑–¥)
- **Webhook** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

### –°–≤—è–∑–∏ –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏:
- City ‚Üî Clinic (many-to-many)
- Clinic ‚Üî Doctor (many-to-many) 
- Doctor ‚Üí Review (one-to-many)
- City ‚Üí Application (one-to-many)
- Doctor ‚Üí Application (one-to-many)

## ‚úÖ –ß–¢–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–¥–µ–ª–∏
- ‚úÖ –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- ‚úÖ Eloquent –º–æ–¥–µ–ª–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Å–≤—è–∑—è–º–∏
- ‚úÖ –°–∏–¥–µ—Ä—ã —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –∏ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏

### 2. API (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º Flask)
- ‚úÖ `GET /api/v1/cities/` - —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤
- ‚úÖ `POST /api/v1/applications/create/` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
- ‚úÖ `GET /api/v1/webhook/` - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å webhook
- ‚úÖ –ü–æ–ª–Ω—ã–π RESTful API –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π

### 3. Telegram Bot (BotMan)
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/start` —Å –≥–ª–∞–≤–Ω—ã–º –º–µ–Ω—é
- ‚úÖ –î–∏–∞–ª–æ–≥ –∑–∞–ø–∏—Å–∏ –Ω–∞ –ø—Ä–∏–µ–º (ApplicationConversation)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ—Ç–∑—ã–≤–æ–≤ (ReviewConversation) 
- ‚úÖ Deep links –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤: `t.me/–±–æ—Ç?start=review_uuid`
- ‚úÖ –ü—Ä–æ–º–æ-–∫–æ–¥—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∑–∞–ø–∏—Å–∏
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞" (request_contact)
- ‚úÖ File storage –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π (–≤–º–µ—Å—Ç–æ Redis)
- ‚úÖ Webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 4. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (Filament)
- ‚úÖ –†–µ—Å—É—Ä—Å—ã –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
- ‚úÖ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –î–æ—Å—Ç—É–ø: http://127.0.0.1:8000/admin
- ‚úÖ –õ–æ–≥–∏–Ω: admin@admin.ru / password

### 5. –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ `php artisan telegram:info` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ
- ‚úÖ `php artisan telegram:webhook <url>` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ webhook
- ‚úÖ `php artisan bot:start-testing` - –∞–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ `php artisan bot:test` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## üîß –¢–ï–ö–£–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò

### Environment (.env):
```
TELEGRAM_TOKEN=8339267972:AAFTDl565kF2mH-vEqdOWh-hf7KPqjgva28
TELEGRAM_WEBHOOK_URL=https://33963c6eaa18.ngrok-free.app/botman
```

### BotMan –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- –î—Ä–∞–π–≤–µ—Ä: Telegram
- Storage: File (storage/botman/)
- Cache: File (storage/botman/cache/)

### CSRF –∑–∞—â–∏—Ç–∞:
- –ò—Å–∫–ª—é—á–µ–Ω–∏—è: `botman`, `api/*`
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ `bootstrap/app.php`

## üéØ –§–£–ù–ö–¶–ò–û–ù–ê–õ –ë–û–¢–ê

### –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (/start):
1. üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏–µ–º
2. üë©üèª‚Äç‚öïÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Ä–∞—á–µ–π
3. üéÅ –ó–∞–ø–∏—Å—å —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º
4. üëâ –¢–µ–ª–µ–≥—Ä–∞–º –∫–∞–Ω–∞–ª

### –î–∏–∞–ª–æ–≥ –∑–∞–ø–∏—Å–∏:
1. –í–≤–æ–¥ –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
2. –í—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞
3. –í—ã–±–æ—Ä –∫–ª–∏–Ω–∏–∫–∏ –∏–ª–∏ –≤—Ä–∞—á–∞
4. –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—Ä–∞—á–µ
5. –í–≤–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
6. –í–≤–æ–¥ –§–ò–û –ø–∞—Ü–∏–µ–Ω—Ç–∞
7. –í–≤–æ–¥ –§–ò–û —Ä–æ–¥–∏—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
8. –°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö
9. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ –≤ –ë–î

### –°–∏—Å—Ç–µ–º–∞ –æ—Ç–∑—ã–≤–æ–≤:
- Deep link: `t.me/medical_center_test_bot?start=review_{doctor_uuid}`
- –û—Ü–µ–Ω–∫–∞ 1-5 –∑–≤–µ–∑–¥
- –¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–∑—ã–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –≤—Ä–∞—á–∞

## üêõ –†–ï–®–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

1. **CSRF –æ—à–∏–±–∫–∞ 419** ‚Üí –¥–æ–±–∞–≤–∏–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è webhook
2. **Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ file storage
3. **BotMan –Ω–µ –æ—Ç–≤–µ—á–∞–ª** ‚Üí –∏—Å–ø—Ä–∞–≤–∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é storage
4. **API 404 –æ—à–∏–±–∫–∏** ‚Üí —Å–æ–∑–¥–∞–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–æ—É—Ç—ã –≤ —Å—Ç–∏–ª–µ Flask

## üöÄ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å ngrok:
1. `ngrok http 8000` (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
2. `php artisan bot:start-testing`
3. –ë–æ—Ç: https://t.me/medical_center_test_bot

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
- `php artisan telegram:info`
- `tail -f storage/logs/laravel.log`

## üìÅ –ö–õ–Æ–ß–ï–í–´–ï –§–ê–ô–õ–´

### –ú–æ–¥–µ–ª–∏:
- `app/Models/User.php`
- `app/Models/Application.php`
- `app/Models/City.php`
- `app/Models/Clinic.php`
- `app/Models/Doctor.php`
- `app/Models/Review.php`
- `app/Models/Webhook.php`

### –ë–æ—Ç:
- `app/Http/Controllers/Bot/BotController.php`
- `app/Bot/Conversations/ApplicationConversation.php`
- `app/Bot/Conversations/ReviewConversation.php`
- `config/botman.php`

### API:
- `routes/api.php`
- `app/Http/Controllers/Api/`
- `app/Http/Resources/`

### –ú–∏–≥—Ä–∞—Ü–∏–∏:
- `database/migrations/` (–≤—Å–µ —Ñ–∞–π–ª—ã)
- `database/seeders/`

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –≠–¢–ê–ü–´

### –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å 1C** —á–µ—Ä–µ–∑ Laravel Queues
2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** —á–µ—Ä–µ–∑ webhook API
3. **–§–∞–π–ª—ã** (—Ñ–æ—Ç–æ –≤—Ä–∞—á–µ–π, –¥–∏–ø–ª–æ–º—ã)
4. **–¢–µ—Å—Ç—ã** (Unit, Feature)
5. **Docker** –¥–ª—è –¥–µ–ø–ª–æ—è
6. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** (Redis –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)

### –ü—Ä–æ–º–æ-–∫–æ–¥—ã (—É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç):
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–¥–æ–≤
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∫–∏–¥–æ–∫
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üîó –ü–û–õ–ï–ó–ù–´–ï –°–°–´–õ–ö–ò

- **–ë–æ—Ç:** https://t.me/medical_center_test_bot
- **–ê–¥–º–∏–Ω–∫–∞:** http://127.0.0.1:8000/admin
- **API:** http://127.0.0.1:8000/api/v1/
- **Laravel Docs:** https://laravel.com/docs
- **BotMan Docs:** https://botman.io/

---

**üí° –í–ê–ñ–ù–û:** –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞. –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ –≤ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ Cursor –ø—Ä–æ—Å—Ç–æ —Å—Å—ã–ª–∞–π—Ç–µ—Å—å –Ω–∞ –Ω–µ–≥–æ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.



